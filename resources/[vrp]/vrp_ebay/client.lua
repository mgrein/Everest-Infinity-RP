-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONEXÃO
-----------------------------------------------------------------------------------------------------------------------------------------
src = {}
Tunnel.bindInterface("vrp_ebay",src)
vSERVER = Tunnel.getInterface("vrp_ebay")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIÁVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local ebayOpen = false
-----------------------------------------------------------------------------------------------------------------------------------------
-- EBAYLOCS
-----------------------------------------------------------------------------------------------------------------------------------------
local ebaylocs = {
	{ ['x'] = 591.16, ['y'] = 2744.64, ['z'] = 42.04 },
	{ ['x'] = -59.49, ['y'] = 6523.90, ['z'] = 31.49 },
	{ ['x'] = 246.58, ['y'] = 223.30, ['z'] = 106.28 },
	{ ['x'] = 29.20, ['y'] = -1770.03, ['z'] = 29.60 },
	{ ['x'] = 288.97, ['y'] = -1266.82, ['z'] = 29.44 },
	{ ['x'] = 1160.00, ['y'] = -314.89, ['z'] = 69.20 }
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- OPEN DEALER
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	SetNuiFocus(false,false)
	while true do
		Citizen.Wait(5)
		local ped = PlayerPedId()
		if not IsPedInAnyVehicle(ped) then
			local x,y,z = table.unpack(GetEntityCoords(ped))
			for k,v in pairs(ebaylocs) do
				local distance = Vdist(x,y,z,v.x,v.y,v.z)
				if distance <= 10.5 then
					DrawMarker(21,v.x,v.y,v.z-0.6,0,0,0,0.0,0,0,0.5,0.5,0.4,255,0,0,50,0,0,0,1)
					if distance <= 1.2 and IsControlJustPressed(0,38) and vSERVER.checkSearch() then
						SetNuiFocus(true,true)
						SendNUIMessage({ action = "showMenu" })
						ebayOpen = true
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- EBAYCLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("ebayClose",function(data)
	SetNuiFocus(false,false)
	SendNUIMessage({ action = "hideMenu" })
	ebayOpen = false
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTEBAYLIST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("requestEbayList",function(data,cb)
	local ebaylist = vSERVER.ebayList()
	if ebaylist then
		cb({ ebaylist = ebaylist })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTINVLIST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("requestinvList",function(data,cb)
	local invlist = vSERVER.invList()
	if invlist then
		cb({ invlist = invlist })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- EBAYBUY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("ebayBuy",function(data)
	if data.id ~= nil then
		vSERVER.ebayBuy(data.id,data.userid,data.price,data.qtd,data.itemid)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- EBAYSELL
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("ebaySell",function(data)
	if data.amount ~= nil then
		vSERVER.ebaySell(data.amount,data.itemid,data.price,data.anony)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- EBAYEXTRACT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("ebayExtract",function(data)
	if data.id ~= nil then
		vSERVER.ebayExtract(data.id,data.userid,data.qtd,data.itemid)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- AUTO-UPDATE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("ebay:Update")
AddEventHandler("ebay:Update",function(action)
	SendNUIMessage({ action = action })
end)