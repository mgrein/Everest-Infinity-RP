-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONEXÃO
-----------------------------------------------------------------------------------------------------------------------------------------
src = {}
Tunnel.bindInterface("vrp_business",src)
vSERVER = Tunnel.getInterface("vrp_business")
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPLIST
-----------------------------------------------------------------------------------------------------------------------------------------
local shoplist = {
	{ 1,28.92,-1339.25,29.49 },
	{ 2,2549.33,385.58,108.62 },
	{ 3,1159.77,-315.24,69.20 },
	{ 4,-709.67,-905.40,19.21 },
	{ 5,-44.17,-1749.35,29.42 },
	{ 6,378.84,333.14,103.56 },
	{ 7,-3249.90,1005.10,12.83 },
	{ 8,1735.43,6420.46,35.03 },
	{ 9,545.70,2662.77,42.15 },
	{ 10,1959.91,3749.20,32.34 },
	{ 11,2673.17,3287.22,55.24 },
	{ 12,1706.82,4921.10,42.06 },
	{ 13,-1828.30,797.87,138.18 },
	{ 14,1391.00,3606.10,34.98 },
	{ 15,-2966.32,392.91,15.04 },
	{ 16,-3047.99,586.31,7.90 },
	{ 17,1134.51,-984.50,46.41 },
	{ 18,1163.94,2710.87,38.15 },
	{ 19,-1487.72,-376.58,40.16 },
	{ 20,-1220.27,-907.16,12.32 },
	{ 21,71.28,-1391.63,29.37 },
	{ 22,-709.14,-151.39,37.41 },
	{ 23,-165.10,-303.42,39.73 },
	{ 24,429.63,-807.34,29.49 },
	{ 25,-823.58,-1069.53,11.32 },
	{ 26,-1193.87,-766.19,17.31 },
	{ 27,-1448.67,-237.70,49.81 },
	{ 28,6.86,6508.77,31.87 },
	{ 29,1698.07,4822.38,42.06 },
	{ 30,127.37,-224.95,54.55 },
	{ 31,612.33,2763.11,42.08 },
	{ 32,1197.64,2714.30,38.22 },
	{ 33,-3169.04,1042.60,20.86 },
	{ 34,-1103.43,2714.24,19.10 },
	{ 35,1696.10,3760.50,34.70 },
	{ 36,250.08,-51.54,69.94 },
	{ 37,840.20,-1032.14,28.19 },
	{ 38,-327.81,6084.29,31.45 },
	{ 39,-660.06,-936.73,21.82 },
	{ 40,-1307.72,-396.06,36.69 },
	{ 41,-1115.18,2698.87,18.55 },
	{ 42,2565.70,295.73,108.73 },
	{ 43,-3169.76,1089.22,20.83 },
	{ 44,23.45,-1108.93,29.79 },
	{ 45,808.18,-2156.14,29.61 },
	{ 46,-821.90,-183.29,37.56 },
	{ 47,138.33,-1703.75,29.29 },
	{ 48,-1278.70,-1115.43,6.99 },
	{ 49,1928.08,3732.92,32.84 },
	{ 50,1216.84,-472.07,66.20 },
	{ 51,-32.68,-156.93,57.07 },
	{ 52,-274.14,6226.47,31.69 },
	{ 53,1324.05,-1649.65,52.27 },
	{ 54,-1152.63,-1423.24,4.95 },
	{ 55,319.54,180.21,103.58 },
	{ 56,-3169.77,1072.77,20.82 },
	{ 57,1866.65,3746.17,33.03 },
	{ 58,-296.70,6200.92,31.48 },
	{ 59,289.32,-1266.95,29.44 },
	{ 60,818.15,-1040.89,26.75 },
	{ 61,1211.16,-1388.95,35.37 },
	{ 62,1180.93,-329.80,69.31 },
	{ 63,642.22,260.42,103.29 },
	{ 64,2559.26,373.76,108.62 },
	{ 65,166.93,-1553.37,29.26 },
	{ 66,-342.51,-1474.99,30.74 },
	{ 67,1776.32,3327.48,41.43 },
	{ 68,46.68,2789.43,57.87 },
	{ 69,265.87,2598.21,44.84 },
	{ 70,1039.34,2664.24,39.55 },
	{ 71,1200.55,2655.73,37.85 },
	{ 72,2545.21,2591.92,37.95 },
	{ 73,2673.86,3266.97,55.24 },
	{ 74,2001.41,3779.87,32.18 },
	{ 75,1702.74,4916.96,42.07 },
	{ 76,1706.18,6425.68,32.77 },
	{ 77,180.63,6598.99,32.04 },
	{ 78,-92.65,6409.81,31.64 },
	{ 79,-2544.09,2315.95,33.21 },
	{ 80,-1800.09,803.63,138.65 },
	{ 81,-1427.96,-268.30,46.22 },
	{ 82,-2073.19,-327.32,13.31 },
	{ 83,-702.76,-916.76,19.21 },
	{ 84,-531.41,-1221.10,18.45 },
	{ 85,-70.81,-1762.08,29.65 },
	{ 86,-571.74,285.78,79.18 },
	{ 87,92.59,-1291.84,29.27 },
	{ 88,1982.44,3053.42,47.22 },
	{ 89,1121.05,-3144.85,-37.06 },
	{ 90,1001.05,-3170.24,-34.07 }
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPFUNCTIONS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("shop",function(source,args)
	local ped = PlayerPedId()
	local x,y,z = table.unpack(GetEntityCoords(ped))
	for k,v in pairs(shoplist) do
		local bowz,cdz = GetGroundZFor_3dCoord(v[2],v[3],v[4])
		local distance = GetDistanceBetweenCoords(v[2],v[3],cdz,x,y,z,true)
		if distance <= 2.5 then
			if args[1] == "buy" then
				vSERVER.buyBusiness(v[1])
			elseif args[1] == "sell" then
				vSERVER.sellBusiness(v[1])
			elseif args[1] == "launded" then
				vSERVER.laundBusiness(v[1],parseInt(args[2]))
			elseif args[1] == "invest" then
				vSERVER.investBusiness(v[1],parseInt(args[2]))
			elseif args[1] == "check" then
				vSERVER.checkBusiness(v[1])
			elseif args[1] == "info" then
				vSERVER.infoBusiness(v[1])
			elseif args[1] == "add" then
				vSERVER.addBusiness(v[1],parseInt(args[2]))
			elseif args[1] == "rem" then
				vSERVER.remBusiness(v[1],parseInt(args[2]))
			elseif args[1] == "trans" then
				vSERVER.transBusiness(v[1],parseInt(args[2]))
			else
				TriggerEvent("Notify","importante","<b>Buy:</b> Comprar o estabelecimento.<br><b>Sell:</b> Vender o estabelecimento.<br><b>Launded:</b> Lavagem de dinheiro.<br><b>Invest:</b> Investimento de dinheiro.<br><b>Check:</b> Informações do proprietário.<br><b>Info:</b> Informações do estabelecimento.<br><b>Trans:</b> Transfere o estabelecimento.",20000)
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPMSG
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(5)
		local ped = PlayerPedId()
		local x,y,z = table.unpack(GetEntityCoords(ped))
		for k,v in pairs(shoplist) do
			if Vdist(x,y,z,v[2],v[3],v[4]) <= 2.0 then
				drawText3D(v[2],v[3],v[4],"~y~/~w~SHOP")
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DRAWTEXT3D
-----------------------------------------------------------------------------------------------------------------------------------------
function drawText3D(x,y,z,text)
	local onScreen,_x,_y = World3dToScreen2d(x,y,z)
	SetTextFont(4)
	SetTextScale(0.35,0.35)
	SetTextColour(255,255,255,150)
	SetTextEntry("STRING")
	SetTextCentre(1)
	AddTextComponentString(text)
	DrawText(_x,_y)
	local factor = (string.len(text))/370
	DrawRect(_x,_y+0.0125,0.01+factor,0.03,0,0,0,50)
end